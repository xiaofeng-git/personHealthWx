<view class="container">
  <!-- å·²ç™»å½•åæ˜¾ç¤ºæ­£å¸¸å†…å®¹ -->
  <block wx:if="{{hasUserInfo}}">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <view class="header">
      <text class="title">å¥åº·åŠ©æ‰‹</text>
      <view class="avatar-container" bindtap="goToProfile">
        <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
      </view>
    </view>

    <!-- ä»Šæ—¥è¥å…»æ‘„å…¥ -->
    <view class="card nutrition-card">
      <view class="card-title">
        <text class="title-text">ä»Šæ—¥è¥å…»</text>
        <text class="title-emoji">ğŸ¥—</text>
      </view>
      
      <view class="calories-progress">
        <view class="progress-circle">
          <text class="calories-value">{{dailyNutrition.calories.value || 0}}</text>
          <text class="calories-label">åƒå¡</text>
          <text class="calories-target">æ¶ˆè€—: {{dailyNutrition.calories.goal || 0}}åƒå¡</text>
        </view>
        </view>
      <view class="nutrition-bars">
        <view class="nutrition-bar">
          <text class="bar-label">è›‹ç™½è´¨</text>
          <view class="bar-container">
            <view class="bar-progress {{!dailyNutrition.protein.value ? 'empty' : ''}}" 
              style="width: {dailyNutrition.protein.percent}%">
        </view>
      </view>
          <text class="bar-value">{{dailyNutrition.protein.value || 0}}g</text>
        </view>
        <view class="nutrition-bar">
          <text class="bar-label">ç¢³æ°´</text>
          <view class="bar-container">
            <view class="bar-progress {{!dailyNutrition.carbs.value ? 'empty' : ''}}"
              style="width: {dailyNutrition.carbs.percent}%">
        </view>
      </view>
          <text class="bar-value">{{dailyNutrition.carbs.value || 0}}g</text>
        </view>
        <view class="nutrition-bar">
          <text class="bar-label">è„‚è‚ª</text>
          <view class="bar-container">
            <view class="bar-progress {{!dailyNutrition.fat.value ? 'empty' : ''}}"
              style="width: {dailyNutrition.fat.percent}%">
        </view>
      </view>
          <text class="bar-value">{{dailyNutrition.fat.value || 0}}g</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥é¤é£Ÿ -->
    <view class="card meals-card">
      <view class="card-title">
        <text class="title-text">ä»Šæ—¥é¥®é£Ÿ</text>
        <text class="title-emoji">ğŸ½</text>
      </view>
      <view class="meals-list">
        <view class="meal-item" bindtap="goToFood" data-meal-type="BREAKFAST" hover-class="item-hover">
          <text class="meal-emoji">ğŸ³</text>
          <text class="meal-type">æ—©é¤</text>
          <text class="meal-content">{{todayMeals.breakfast || 'ç‚¹å‡»è®°å½•'}}</text>
        </view>
        <view class="meal-item" bindtap="goToFood" data-meal-type="LUNCH" hover-class="item-hover">
          <text class="meal-emoji">ğŸ±</text>
          <text class="meal-type">åˆé¤</text>
          <text class="meal-content">{{todayMeals.lunch || 'ç‚¹å‡»è®°å½•'}}</text>
        </view>
        <view class="meal-item" bindtap="goToFood" data-meal-type="DINNER" hover-class="item-hover">
          <text class="meal-emoji">ğŸ´</text>
          <text class="meal-type">æ™šé¤</text>
          <text class="meal-content">{{todayMeals.dinner || 'ç‚¹å‡»è®°å½•'}}</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥è¿åŠ¨ -->
    <view class="card exercise-card">
      <view class="card-title">
        <text class="title-text">ä»Šæ—¥è¿åŠ¨</text>
        <text class="title-emoji">ğŸƒ</text>
      </view>
      <block wx:if="{{todayExercises.length > 0}}">
        <view class="exercise-list">
          <view class="exercise-item" wx:for="{{todayExercises}}" wx:key="id">
            <text class="exercise-name">{{item.type}}</text>
            <text class="exercise-info">{{item.duration}}åˆ†é’Ÿ ğŸ”¥{{item.calories}}åƒå¡</text>
          </view>
        </view>
      </block>
      <view wx:else class="no-exercise" bindtap="goToExercise" hover-class="item-hover">
        <text>å¼€å§‹è®°å½•</text>
      </view>
    </view>

    <!-- å¥åº·å»ºè®® -->
    <view class="card tips-card">
      <view class="card-title">
        <text class="title-text">å°è´´å£«</text>
        <text class="title-emoji">ğŸ’¡</text>
      </view>
      <text class="tip-content">{{healthTip || 'è®°å¾—å¤šå–æ°´å“¦ï¼ğŸ’§'}}</text>
    </view>
  </block>

  <!-- æˆæƒæç¤ºå¼¹çª— -->
  <view class="auth-modal" wx:if="{{showAuthModal}}">
    <view class="auth-content">
      <view class="auth-title">å¾®ä¿¡æˆæƒç™»å½•</view>
      <view class="auth-desc">è·å–ä½ çš„æ˜µç§°ã€å¤´åƒç­‰ä¿¡æ¯</view>
      <button class="auth-btn" open-type="getUserInfo" bindtap="handleLogin">ç¡®è®¤æˆæƒ</button>
    </view>
  </view>
</view> 