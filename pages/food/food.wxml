<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <text class="title">é¥®é£Ÿè®°å½•</text>
    <view class="remaining-count">
      <text class="count-icon">ğŸ”</text>
      <text>å‰©ä½™{{remainingCalls}}æ¬¡</text>
    </view>
  </view>

  <!-- é¤é£Ÿç±»å‹é€‰æ‹© -->
  <view class="meal-type-section card">
    <view class="meal-type-tabs">
      <view 
        class="tab-item {{mealType === type.value ? 'active' : ''}}" 
        wx:for="{{mealTypes}}" 
        wx:key="value"
        wx:for-item="type"
        bindtap="selectMealType"
        data-value="{{type.value}}"
      >
        <text class="tab-emoji">{{type.emoji}}</text>
        <text class="tab-text">{{type.label}}</text>
      </view>
    </view>
  </view>

  <!-- æ‹ç…§åŒºåŸŸ -->
  <view class="photo-section {{!imgUrl ? 'empty' : ''}}" bindtap="{{!imgUrl ? 'chooseImage' : ''}}">
    <block wx:if="{{!imgUrl}}">
      <view class="photo-button">
        <text class="camera-icon">ğŸ“·</text>
        <text class="photo-tip">ç‚¹å‡»æ‹ç…§è®°å½•é¤é£Ÿ</text>
      </view>
    </block>
    <block wx:else>
      <view class="photo-container">
        <image class="food-image" src="{{imgUrl}}" mode="aspectFill"></image>
        <view class="photo-time">{{currentTime}}</view>
      </view>
    </block>
  </view>

  <!-- åˆ†æç»“æœ -->
  <view class="result-section card" wx:if="{{imgUrl && rawResult}}">
    <view class="section-header">
      <text class="section-title">åˆ†æç»“æœ</text>
      <text class="section-emoji">ğŸ¥—</text>
    </view>
    
    <!-- å¡è·¯é‡Œå±•ç¤º -->
    <view class="calories-display">
      <text class="calories-value">{{nutritionInfo.calories || 0}}</text>
      <text class="calories-unit">åƒå¡</text>
      <text class="calories-target">/1500kcal</text>
    </view>

    <!-- è¥å…»æ„æˆ -->
    <view class="nutrition-chart">
      <view class="chart-container">
        <!-- è¿™é‡Œå¯ä»¥æ·»åŠ ç¯å½¢å›¾ç»„ä»¶ -->
        <nutrition-ring-chart nutritionData="{{nutritionInfo}}"></nutrition-ring-chart>
      </view>
      <view class="nutrition-details">
        <view class="nutrition-item protein">
          <text class="item-icon">ğŸ¥š</text>
          <text class="item-label">è›‹ç™½è´¨</text>
          <text class="item-value">{{nutritionInfo.protein || 0}}g</text>
        </view>
        <view class="nutrition-item carbs">
          <text class="item-icon">ğŸš</text>
          <text class="item-label">ç¢³æ°´</text>
          <text class="item-value">{{nutritionInfo.carbs || 0}}g</text>
        </view>
        <view class="nutrition-item fat">
          <text class="item-icon">ğŸ¥‘</text>
          <text class="item-label">è„‚è‚ª</text>
          <text class="item-value">{{nutritionInfo.fat || 0}}g</text>
        </view>
      </view>
    </view>

    <!-- å¥åº·å°è´´å£« -->
    <view class="health-tips">
      <text class="tips-icon">ğŸ’¡</text>
      <text class="tips-content">{{healthTip || 'è®°å¾—å¤šå–æ°´ï¼Œä¿æŒè¥å…»å‡è¡¡å“¦ï¼'}}</text>
    </view>

    <!-- è¯¦ç»†åˆ†ææ–‡æœ¬ -->
    <view class="analysis-text-section">
      <view class="analysis-header" bindtap="toggleAnalysis">
        <text class="analysis-title">è¯¦ç»†åˆ†æ</text>
        <text class="expand-icon">{{isAnalysisExpanded ? 'â†‘' : 'â†“'}}</text>
      </view>
      <view class="analysis-content {{isAnalysisExpanded ? 'expanded' : ''}}">
        <text user-select="true">{{rawResult}}</text>
      </view>
    </view>

    <button class="save-btn {{isSaved ? 'saved' : ''}}" bindtap="saveRecord">
      <text wx:if="{{!isSaved}}">ä¿å­˜è®°å½•</text>
      <text wx:else>âœ”ï¸ å·²ä¿å­˜</text>
    </button>
  </view>

  <!-- å¥åº·å»ºè®®éƒ¨åˆ† -->
  <!-- <view class="advice-section" wx:if="{{healthAdvice}}">
    <view class="section-title">å¥åº·å»ºè®®</view>
    <view class="advice-item">
      <text class="label">è¥å…»åˆ†æï¼š</text>
      <text class="content" user-select="true">{{healthAdvice.nutritionAnalysis}}</text>
    </view>
    <view class="advice-item">
      <text class="label">é€‚åˆäººç¾¤ï¼š</text>
      <text class="content" user-select="true">{{healthAdvice.suitableGroups}}</text>
    </view>
    <view class="advice-item">
      <text class="label">é£Ÿç”¨å»ºè®®ï¼š</text>
      <text class="content" user-select="true">{{healthAdvice.consumptionTips}}</text>
    </view>
    <view class="advice-item">
      <text class="label">æ³¨æ„äº‹é¡¹ï¼š</text>
      <text class="content" user-select="true">{{healthAdvice.precautions}}</text>
    </view>
  </view> -->

  <!-- è¥å…»å›¾è¡¨ -->
  <!-- <view class="chart-section">
    <nutrition-chart nutritionData="{{nutritionInfo}}" wx:if="{{nutritionInfo}}"></nutrition-chart>
  </view> -->

  <!-- å†å²è®°å½• -->
  <view class="history-section card">
    <view class="section-header">
      <text class="section-title">å†å²è®°å½•</text>
      <text class="section-emoji">ğŸ“…</text>
    </view>
    <view class="history-grid">
      <block wx:if="{{historyRecords.length > 0}}">
        <view class="history-item" wx:for="{{historyRecords}}" wx:key="id" bindtap="showHistoryDetail" data-id="{{item.id}}">
          <image 
            class="history-image" 
            src="{{item.imageUrl}}" 
            mode="aspectFill"
            wx:if="{{item.imageUrl}}"
          ></image>
          <view class="history-overlay">
            <view class="history-header">
              <text class="history-meal-type">{{item.mealType}}</text>
              <text class="history-time">{{item.createTime}}</text>
            </view>
            <view class="history-nutrition">
              <view class="nutrition-row">
                <text class="nutrition-label">çƒ­é‡</text>
                <text class="nutrition-value">{{item.calories}}åƒå¡</text>
              </view>
              <view class="nutrition-row">
                <text class="nutrition-label">è›‹ç™½è´¨</text>
                <text class="nutrition-value">{{item.protein}}g</text>
              </view>
              <view class="nutrition-row">
                <text class="nutrition-label">ç¢³æ°´</text>
                <text class="nutrition-value">{{item.carbs}}g</text>
              </view>
              <view class="nutrition-row">
                <text class="nutrition-label">è„‚è‚ª</text>
                <text class="nutrition-value">{{item.fat}}g</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:else class="no-records">
        <text class="no-records-icon">ğŸ“</text>
        <text>æš‚æ— é¥®é£Ÿè®°å½•</text>
      </view>
    </view>
  </view>
</view> 